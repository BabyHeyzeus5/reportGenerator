<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>Processed Report</h2>

    <div id="reportContainer"></div>
    <label for="filenameInput">Enter filename (without extension): </label>
    <input type="text" id="filenameInput" placeholder="Enter filename">

    <button id="downloadCsvBtn">Download as CSV</button>
    <a href="index.html">Upload Another File</a>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Retrieve the table HTML string from localStorage
            const tableHTML = localStorage.getItem("reportTable");

            // Check if there's a report in localStorage
            if (tableHTML) {
                document.getElementById("reportContainer").innerHTML = tableHTML;
            } else {
                document.getElementById("reportContainer").innerHTML = "<p>No report available. Please upload a file and process it first.</p>";
            }

            // Download button functionality
            document.getElementById("downloadCsvBtn").addEventListener("click", function() {
                // Get the HTML table
                const table = document.querySelector("#reportContainer table");

                if (table) {
                    let filename = document.getElementById("filenameInput").value.trim();
                    if (!filename) {
                        filename = "report"
                    }
                    
                    filename += ".csv"

                    // Convert the table to CSV format
                    const csv = tableToCsv(table);

                    // Trigger a file download
                    downloadCsv(csv, filename);
                } else {
                    alert("No table found to download.");
                }
            });
        });

        // Function to convert HTML table to CSV
        function tableToCsv(table) {
            const rows = Array.from(table.rows);
            const csvRows = [];

            rows.forEach(row => {
                const cols = Array.from(row.cells);
                const csvRow = cols.map(col => col.textContent).join(",");
                csvRows.push(csvRow);
            });

            return csvRows.join("\n");
        }

        // Function to trigger the download of the CSV file
        function downloadCsv(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
